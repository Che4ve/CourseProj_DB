---
name: Документ для защиты курсовой работы
overview: Создание подробного документа, который сопоставляет каждый пункт технического задания с конкретной реализацией в проекте, включая пути к файлам, примеры кода и инструкции для демонстрации
todos: []
---

# П

лан создания документа для защиты курсовой работы

## Цель

Создать подробный документ, который для каждого пункта из ТЗ показывает:

- Где это реализовано (конкретные файлы и пути)
- Как это реализовано (примеры кода)
- Как это продемонстрировать (SQL-запросы, команды, примеры)

## Структура документа

### 1. Раздел 2: Требования к базе данных

#### 2.1. Структура (9-10 таблиц, связи 1:1, 1:N, N:M)

- **Файл схемы**: `packages/db/prisma/schema.prisma`
- **13 таблиц**: users, user_profiles, habits, habit_schedules, habit_checkins, tags, habit_tags, reminders, habit_stats, audit_log, _manual_migrations, batch_import_jobs, batch_import_errors
- **Связи**:
- 1:1: User ↔ UserProfile (строка 36-48)
- 1:N: User → Habits (строка 28), Habit → Checkins (строка 66)
- N:M: Habit ↔ Tag через HabitTag (строка 125-139)
- **Демонстрация**: SQL-запросы для проверки связей

#### 2.2. Ограничения целостности

- **Файлы**: 
- `packages/db/prisma/migrations/20251221144037_init/migration.sql` (PK, FK, UNIQUE)
- `packages/db/prisma/migrations/20251222120000_add_check_constraints/migration.sql` (CHECK)
- **Примеры**: PRIMARY KEY, FOREIGN KEY с CASCADE, UNIQUE, CHECK constraints
- **Демонстрация**: SQL для проверки ограничений

#### 2.3. Объём и наполнение

- **Файл seed**: `packages/db/scripts/seed.ts`
- **Объёмы**: 100 users, 800 habits, 10000 checkins, 50 tags
- **Демонстрация**: SQL COUNT запросы

### 2. Раздел 3: SQL-функциональность

#### 3.1. CRUD-операции

- **Backend модули**: `apps/backend/src/habits/`, `apps/backend/src/checkins/`, и др.
- **ORM**: Prisma Client (базовые CRUD)
- **Сложные запросы**: `apps/backend/src/reports/reports.service.ts` (чистый SQL)
- **Демонстрация**: Swagger UI и примеры запросов

#### 3.2. Триггеры и функции

- **Триггеры**: `packages/db/sql/001_triggers.sql`
- `audit_trigger_fn()` - аудит изменений
- `update_habit_stats()` - обновление агрегатов
- **Функции**: `packages/db/sql/002_functions.sql`
- `calc_completion_rate()` - скалярная
- `report_user_habits()` - табличная
- **Демонстрация**: SQL для проверки работы триггеров

#### 3.3. Представления (VIEW)

- **Файл**: `packages/db/sql/003_views.sql`
- **3 представления**: v_user_habit_summary, v_daily_completion, v_tag_usage
- **Демонстрация**: SELECT из представлений

### 3. Раздел 4: Оптимизация и анализ запросов

- **Индексы**: `packages/db/sql/004_indexes.sql`
- **Анализ**: `docs/perf.md` с EXPLAIN ANALYZE до/после
- **Демонстрация**: Примеры запросов с EXPLAIN ANALYZE

### 4. Раздел 5: Интеграция с backend

- **Backend**: NestJS (`apps/backend/`)
- **API**: RESTful с модулями (habits, checkins, reports, batch-import)
- **Swagger**: `apps/backend/src/main.ts` (строка 48-57)
- **Транзакции**: `apps/backend/src/batch-import/batch-import.service.ts`
- **Демонстрация**: Swagger UI и примеры API запросов

### 5. Раздел 7: Контейнеризация

- **Файл**: `docker-compose.yml`
- **Сервисы**: db (PostgreSQL), backend (NestJS), frontend (Next.js)
- **Демонстрация**: Команды docker-compose

### 6. Раздел 8: Демонстрация работы системы

- **Чеклист**: `docs/requirements-checklist.md`
- **Пошаговые инструкции** для каждого пункта демонстрации

## Формат документа

Документ будет содержать:

1. **Номер раздела из ТЗ** (например, "2.1. Структура")
2. **Требование** (цитата из ТЗ)
3. **Где реализовано** (конкретные файлы с путями)
4. **Как реализовано** (примеры кода с номерами строк)
5. **Как продемонстрировать** (SQL-запросы, команды, примеры)

## Файлы для создания

1. **Основной документ**: `docs/defense-guide.md` - подробное руководство для защиты
2. **Краткая шпаргалка**: `docs/defense-quick-reference.md` - быстрая справка с ключевыми моментами

## Особое внимание

- **Штрафы**: проверка отсутствия секретов в коде, параметризация SQL