---
name: План написания отчета по ГОСТ 7.32-2017
overview: "Создание полного отчета о курсовой работе по базам данных в формате LaTeX, соответствующего ГОСТ 7.32-2017, включающего все разделы: титульный лист, содержание, введение, аналитическую часть, проектную часть, технологическую часть, заключение и приложения."
todos:
  - id: create_latex_structure
    content: "Создать структуру LaTeX проекта: директорию report/, файлы main.tex, titlepage.tex, content.tex и другие разделы"
    status: pending
  - id: write_titlepage
    content: Написать титульный лист с информацией о студенте, группе, преподавателе и университете МАИ
    status: pending
    dependencies:
      - create_latex_structure
  - id: write_introduction
    content: Написать введение (актуальность, объект, предмет, цель, задачи) - не более 1 страницы
    status: pending
    dependencies:
      - create_latex_structure
  - id: write_analytical
    content: "Написать аналитическую часть: обзор предметной области и постановка задачи (не более 2 страниц)"
    status: pending
    dependencies:
      - create_latex_structure
  - id: write_project_architecture
    content: "Написать раздел 2.1: описание архитектуры системы (технологический стек, структура проекта)"
    status: pending
    dependencies:
      - create_latex_structure
  - id: write_project_database
    content: "Написать разделы 2.2-2.4: проектирование БД, описание таблиц, ограничения целостности"
    status: pending
    dependencies:
      - create_latex_structure
  - id: write_project_sql
    content: "Написать раздел 2.5: реализация SQL-функциональности (CRUD, триггеры, функции, представления)"
    status: pending
    dependencies:
      - create_latex_structure
  - id: write_project_api
    content: "Написать раздел 2.6: описание API и взаимодействия с БД"
    status: pending
    dependencies:
      - create_latex_structure
  - id: write_project_performance
    content: "Написать раздел 2.7: примеры SQL-запросов и анализ производительности с EXPLAIN ANALYZE"
    status: pending
    dependencies:
      - create_latex_structure
  - id: write_technical
    content: "Написать технологическую часть: контейнеризация, развертывание, тестирование"
    status: pending
    dependencies:
      - create_latex_structure
  - id: write_conclusion
    content: "Написать заключение: резюме, результаты, соответствие задачам, рекомендации"
    status: pending
    dependencies:
      - create_latex_structure
  - id: create_appendices
    content: "Создать приложения: ER-диаграмма, SQL-скрипты, Swagger документация, результаты EXPLAIN ANALYZE"
    status: pending
    dependencies:
      - create_latex_structure
  - id: create_erd_image
    content: Конвертировать ER-диаграмму из Mermaid в изображение для включения в отчет
    status: pending
    dependencies:
      - create_appendices
  - id: finalize_content
    content: Заполнить содержание с номерами страниц после написания всех разделов
    status: pending
    dependencies:
      - write_titlepage
      - write_introduction
      - write_analytical
      - write_project_architecture
      - write_project_database
      - write_project_sql
      - write_project_api
      - write_project_performance
      - write_technical
      - write_conclusion
  - id: final_check
    content: "Провести финальную проверку: соответствие ГОСТ, нумерация, ссылки, орфография"
    status: pending
    dependencies:
      - finalize_content
      - create_appendices
---

# План написания отчета по ГОСТ 7.32-2017

## Общая структура документа

Отчет будет создан в формате LaTeX с использованием стандартных пакетов (article, babel, geometry) и оформлен согласно ГОСТ 7.32-2017.

## Раздел 1: Титульный лист

### Источники информации

- ФИО студента: Чесноков Василий Дмитриевич
- Группа: М8О-309Б-23
- Преподаватель: Грубенко Максим Дмитриевич
- Университет: МАИ (Московский авиационный институт)
- Институт: № 8 «Компьютерные науки и прикладная математика»
- Кафедра: 806 «Вычислительная математика и программирование»
- Дисциплина: Базы данных
- Тема: Информационная система для трекинга привычек

### Структура титульного листа

1. Министерство науки и высшего образования РФ
2. Название университета (МАИ)
3. Институт и кафедра
4. Название работы: "Курсовой проект"
5. Дисциплина: "Базы данных"
6. Тема проекта
7. Информация о студенте и преподавателе
8. Город и год: Москва 2025

---

## Раздел 2: Содержание

### Структура содержания

```javascript
ВВЕДЕНИЕ ................................................. 3

1 АНАЛИТИЧЕСКАЯ ЧАСТЬ ................................... 4
  1.1 Обзор предметной области ......................... 4
  1.2 Постановка задачи ................................ 5

2 ПРОЕКТНАЯ ЧАСТЬ ...................................... 6
  2.1 Архитектура системы ............................... 6
  2.2 Проектирование структуры базы данных ............. 7
  2.3 Описание таблиц базы данных ...................... 9
  2.4 Ограничения целостности данных .................. 12
  2.5 Реализация SQL-функциональности .................. 14
  2.6 Описание API и взаимодействия с БД ............... 18
  2.7 Примеры SQL-запросов и анализ производительности .. 20

3 ТЕХНОЛОГИЧЕСКАЯ ЧАСТЬ ................................ 23
  3.1 Контейнеризация и развертывание .................. 23
  3.2 Тестирование системы ............................. 24

ЗАКЛЮЧЕНИЕ .............................................. 25

СПИСОК ИСПОЛЬЗОВАННЫХ ИСТОЧНИКОВ ........................ 26

ПРИЛОЖЕНИЕ А ER-диаграмма базы данных .................. 27
ПРИЛОЖЕНИЕ Б Примеры SQL-запросов ....................... 28
ПРИЛОЖЕНИЕ В Swagger документация API .................. 29
```

---

## Раздел 3: Введение

### Содержание раздела (не более 1 страницы)

1. **Актуальность проблемы**

- Важность систематизации и отслеживания привычек
- Роль баз данных в современных информационных системах

2. **Объект исследования**

- Информационная система для трекинга привычек
- Реляционная база данных PostgreSQL

3. **Предмет исследования**

- Проектирование и реализация структуры БД
- Оптимизация запросов и производительности

4. **Цель работы**

- Создать полноценную информационную систему с реляционной БД
- Продемонстрировать навыки проектирования, реализации связей, написания SQL-запросов, работы с триггерами и аудитом

5. **Задачи работы**

- Спроектировать структуру БД (13 таблиц)
- Реализовать ограничения целостности
- Создать триггеры и функции
- Реализовать представления (VIEW)
- Оптимизировать запросы с помощью индексов
- Интегрировать БД с backend-приложением
- Реализовать батчевую загрузку данных

6. **Краткое изложение структуры отчета**

### Источники информации

- Техническое задание: `courseProjTask.txt`
- Общее описание проекта: `README.md`

---

## Раздел 4: Аналитическая часть

### 4.1 Обзор предметной области (не более 1 страницы)

**Содержание:**

- Описание предметной области "Трекер привычек"
- Основные сущности: пользователи, привычки, отметки выполнения, теги, напоминания
- Требования к системе

**Источники:**

- `docs/schema.md` - описание схемы БД
- `packages/db/prisma/schema.prisma` - Prisma схема

### 4.2 Постановка задачи (не более 1 страницы)

**Содержание:**

- Формализация требований к БД
- Требования к структуре (13 таблиц, связи 1:1, 1:N, N:M)
- Требования к объему данных (500-1000 записей в крупных таблицах, 5000+ в транзакционных)
- Требования к функциональности (CRUD, триггеры, функции, представления, индексы)

**Источники:**

- `courseProjTask.txt` - техническое задание
- `docs/requirements-checklist.md` - чеклист требований

---

## Раздел 5: Проектная часть - ОСНОВНОЙ РАЗДЕЛ

### 5.1 Архитектура системы

**Содержание:**

- Описание архитектуры (монорепозиторий, backend, frontend, БД)
- Технологический стек:
- Backend: NestJS + Prisma ORM
- Frontend: Next.js 15 + React 19
- Database: PostgreSQL 16
- Контейнеризация: Docker + Docker Compose

**Источники:**

- `README.md` - общее описание
- `docker-compose.yml` - конфигурация контейнеров
- `apps/backend/src/app.module.ts` - структура backend

**Визуализация:**

- Диаграмма архитектуры системы (можно создать в Mermaid или нарисовать)

### 5.2 Проектирование структуры базы данных

**Содержание:**

#### 5.2.1 ER-диаграмма

- Описание связей между сущностями
- Типы связей: 1:1, 1:N, N:M
- Примеры:
- 1:1: users ↔ user_profiles
- 1:N: users → habits, habits → checkins
- N:M: habits ↔ tags (через habit_tags)

**Источники:**

- `packages/db/prisma/ERD.md` - ER-диаграмма в формате Mermaid
- `docs/schema.md` - описание связей

#### 5.2.2 Описание таблиц (13 таблиц)

Для каждой таблицы указать:

- Назначение
- Количество атрибутов
- Типы данных (>= 5 разных типов)
- Ключевые поля

**Основные таблицы:**

1. `users` - 8 колонок, 6 типов (UUID, TEXT, VARCHAR, BOOLEAN, TIMESTAMPTZ, INTEGER)
2. `user_profiles` - 8 колонок, 6 типов (UUID, TEXT, VARCHAR, DATE, BOOLEAN, SMALLINT)
3. `habits` - 9 колонок, 7 типов
4. `habit_checkins` - 8 колонок, 6 типов
5. `tags` - 7 колонок, 5 типов
6. `habit_tags` - 7 колонок, 5 типов
7. `habit_schedules` - 7 колонок, 5 типов
8. `reminders` - 8 колонок, 6 типов
9. `habit_stats` - 7 колонок, 5 типов
10. `audit_log` - 9 колонок, 6 типов
11. `batch_import_jobs` - 10 колонок, 7 типов
12. `batch_import_errors` - 7 колонок, 5 типов
13. `_manual_migrations` - 4 колонки, 4 типа

**Источники:**

- `docs/schema.md` - детальное описание всех таблиц
- `packages/db/prisma/schema.prisma` - Prisma схема

#### 5.2.3 Связи между таблицами

**Таблица связей:**

- users (1) ↔ (1) user_profiles
- users (1) → (N) habits
- users (1) → (N) habit_checkins
- habits (1) → (N) habit_checkins
- habits (1) → (N) habit_schedules
- habits (1) → (N) reminders
- habits (N) ↔ (M) tags (через habit_tags)
- habits (1) ↔ (1) habit_stats

**Источники:**

- `docs/schema.md` - раздел "Связи"
- `docs/defense-guide.md` - примеры связей

### 5.3 Ограничения целостности данных

**Содержание:**

#### 5.3.1 PRIMARY KEY

- Все таблицы имеют PRIMARY KEY на поле `id` типа UUID
- Пример: `id UUID PRIMARY KEY DEFAULT gen_random_uuid()`

#### 5.3.2 FOREIGN KEY

- Описание всех внешних ключей
- Каскадное удаление/обновление:
- `ON DELETE CASCADE` для зависимых записей
- `ON DELETE SET NULL` для опциональных связей

**Примеры:**

```sql
-- habits.user_id → users.id
FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE

-- habit_checkins.habit_id → habits.id
FOREIGN KEY (habit_id) REFERENCES habits(id) ON DELETE CASCADE
```



#### 5.3.3 UNIQUE

- `users.email` - уникальный email
- `user_profiles.user_id` - уникальная связь 1:1
- `habit_checkins(habit_id, checkin_date)` - уникальная отметка на день
- `_manual_migrations.name` - уникальное имя миграции

#### 5.3.4 CHECK

- `habits.type IN ('good', 'bad')`
- `habit_checkins.mood_rating >= 1 AND mood_rating <= 5`
- `audit_log.operation IN ('INSERT', 'UPDATE', 'DELETE')`
- `batch_import_jobs.status IN ('pending', 'processing', 'completed', 'failed')`

#### 5.3.5 NOT NULL

- Обязательные поля: `users.email`, `users.password_hash`, `habits.name`, `habits.type`

**Источники:**

- `packages/db/prisma/migrations/` - миграции с ограничениями
- `docs/requirements-checklist.md` - раздел "Ограничения целостности"
- `docs/schema.md` - описание ограничений для каждой таблицы

### 5.4 Реализация SQL-функциональности

#### 5.4.1 CRUD-операции

**Описание:**

- Базовые CRUD через ORM (Prisma)
- Сложные запросы через Raw SQL с параметризацией

**Примеры реализации:**

- Создание привычки через Prisma ORM
- Получение списка привычек с фильтрацией
- Сложные запросы с JOIN для отчётов

**Источники:**

- `apps/backend/src/habits/habits.service.ts` - CRUD операции
- `apps/backend/src/reports/reports.service.ts` - Raw SQL запросы
- `docs/api.md` - описание API endpoints

#### 5.4.2 Триггеры

**Триггеры аудита:**

- `audit_trigger_fn()` - функция для записи в audit_log
- Триггеры на таблицах: habits, habit_checkins, tags, reminders
- Запись old_data и new_data для UPDATE операций

**Триггер агрегатов:**

- `update_habit_stats()` - автоматическое обновление статистики
- Срабатывает при INSERT/UPDATE/DELETE в habit_checkins
- Обновляет habit_stats: total_checkins, average_mood, last_checkin_at

**Источники:**

- `packages/db/sql/001_triggers.sql` - код триггеров
- `docs/defense-guide.md` - описание работы триггеров

#### 5.4.3 Функции

**Скалярная функция:**

- `calc_completion_rate(user_id, from_date, to_date) RETURNS NUMERIC`
- Расчёт процента выполнения привычек за период

**Табличная функция:**

- `report_user_habits(user_id, from_date, to_date) RETURNS TABLE(...)`
- Отчёт по привычкам пользователя с агрегацией

**Источники:**

- `packages/db/sql/002_functions.sql` - код функций
- `docs/api.md` - использование функций в API

#### 5.4.4 Представления (VIEW)

**Три представления:**

1. **v_user_habit_summary**

- Сводка по привычкам пользователя
- Агрегация: total_habits, good_habits, bad_habits, total_checkins

2. **v_daily_completion**

- Ежедневная статистика
- Агрегация: total_checkins, active_users, avg_mood, total_minutes

3. **v_tag_usage**

- Использование тегов
- Агрегация: usage_count, unique_habits, last_used

**Источники:**

- `packages/db/sql/003_views.sql` - код представлений
- `docs/requirements-checklist.md` - описание VIEW

### 5.5 Описание API и взаимодействия с БД

**Содержание:**

#### 5.5.1 Архитектура API

- REST API на NestJS
- Аутентификация через JWT
- Документация через Swagger/OpenAPI

#### 5.5.2 Основные endpoints

**Аутентификация:**

- POST /auth/register
- POST /auth/login
- GET /auth/me

**Привычки (CRUD):**

- GET /habits
- POST /habits
- GET /habits/:id
- PUT /habits/:id
- DELETE /habits/:id

**Отметки выполнения:**

- POST /checkins
- GET /checkins
- DELETE /checkins/:id

**Отчёты:**

- GET /reports/user/:userId - использует функцию report_user_habits()
- GET /reports/completion-rate/:userId - использует calc_completion_rate()

**Batch Import:**

- POST /batch-import
- GET /batch-import/:jobId
- GET /batch-import/:jobId/errors

#### 5.5.3 Безопасность

- Параметризация SQL-запросов (защита от SQL-инъекций)
- Использование Prisma $queryRaw с параметрами
- Хранение секретов в .env файлах

**Источники:**

- `docs/api.md` - полная документация API
- `apps/backend/src/*/*.controller.ts` - контроллеры
- `docs/security-notes.md` - меры безопасности

### 5.6 Примеры SQL-запросов и анализ производительности

#### 5.6.1 Примеры запросов

**Запрос 1: Получение привычек пользователя**

```sql
SELECT * FROM habits 
WHERE user_id = $1 AND NOT is_archived
ORDER BY display_order;
```

**Запрос 2: Отчёт по привычкам (через функцию)**

```sql
SELECT * FROM report_user_habits($1, $2, $3);
```

**Запрос 3: Использование VIEW**

```sql
SELECT * FROM v_user_habit_summary 
WHERE user_id = $1;
```



#### 5.6.2 Анализ производительности

**Оптимизация с помощью индексов:Запрос 1: Отметки пользователя за период**

- До индекса: 145.456 ms (Seq Scan)
- После индекса: 2.789 ms (Index Scan)
- Улучшение: **52x быстрее**

**Запрос 2: Журнал аудита**

- До индекса: 89.456 ms
- После индекса: 1.289 ms
- Улучшение: **69x быстрее**

**Запрос 3: VIEW сводка привычек**

- До индекса: 89.789 ms
- После индекса: 1.289 ms
- Улучшение: **69x быстрее**

**Созданные индексы:**

- `idx_habits_user_id` - partial index на habits(user_id) WHERE NOT is_archived
- `idx_habit_checkins_user_date` - составной индекс на habit_checkins(user_id, checkin_date DESC)
- `idx_audit_log_user_time` - partial index на audit_log(user_id, changed_at DESC)
- И другие (всего 10 индексов)

**Источники:**

- `docs/perf.md` - полный анализ производительности с EXPLAIN ANALYZE
- `packages/db/sql/004_indexes.sql` - код индексов

---

## Раздел 6: Технологическая часть

### 6.1 Контейнеризация и развертывание

**Содержание:**

#### 6.1.1 Docker Compose

- Описание docker-compose.yml
- Сервисы: db (PostgreSQL), backend (NestJS), frontend (Next.js)
- Настройка сетей и volumes

#### 6.1.2 Инструкции по развертыванию

- Установка зависимостей
- Применение миграций БД
- Применение SQL-скриптов (триггеры, функции, views, индексы)
- Заполнение БД тестовыми данными (seed)

**Источники:**

- `docker-compose.yml` - конфигурация
- `README.md` - инструкции по установке
- `docs/setup-guide.md` - подробное руководство

### 6.2 Тестирование системы

**Содержание:**

- Описание тестовых данных (100 пользователей, 800 привычек, 10000 отметок)
- Проверка работы триггеров аудита
- Проверка работы триггеров агрегатов
- Проверка функций и представлений
- Тестирование batch import с обработкой ошибок

**Источники:**

- `packages/db/scripts/seed.ts` - скрипт генерации данных
- `docs/defense-guide.md` - примеры тестирования

---

## Раздел 7: Заключение

**Содержание (1-2 страницы):**

1. **Краткое резюме выполненной работы**

- Создана информационная система с 13 таблицами
- Реализованы все требования технического задания

2. **Основные полученные результаты**

- Структура БД с различными типами связей
- Триггеры для аудита и агрегации данных
- Функции и представления для аналитики
- Оптимизация запросов (улучшение в 60 раз)

3. **Соответствие поставленным задачам**

- Все задачи выполнены полностью

4. **Новизна и значимость**

- Демонстрация навыков проектирования БД
- Применение современных технологий (NestJS, Prisma, PostgreSQL)

5. **Рекомендации по дальнейшему развитию**

- Расширение функциональности
- Оптимизация производительности
- Добавление новых аналитических отчётов

---

## Раздел 8: Список использованных источников (bibliography.tex)

**Источники для включения:**

1. ГОСТ 7.32-2017. Отчет о научно-исследовательской работе. Структура и правила оформления.
2. PostgreSQL 16 Documentation. – URL: https://www.postgresql.org/docs/16/
3. NestJS Documentation. – URL: https://docs.nestjs.com/
4. Prisma Documentation. – URL: https://www.prisma.io/docs
5. Next.js Documentation. – URL: https://nextjs.org/docs
6. Docker Documentation. – URL: https://docs.docker.com/

---

## Раздел 9: Приложения

### Приложение А: ER-диаграмма базы данных

- Включить ER-диаграмму из `packages/db/prisma/ERD.md`
- Конвертировать Mermaid в изображение

### Приложение Б: Примеры SQL-запросов

- Полный код триггеров
- Полный код функций
- Полный код представлений
- Примеры использования

**Источники:**

- `packages/db/sql/001_triggers.sql`
- `packages/db/sql/002_functions.sql`
- `packages/db/sql/003_views.sql`
- `packages/db/sql/004_indexes.sql`

### Приложение В: Swagger документация API

- Скриншот Swagger UI
- Описание основных endpoints

**Источники:**

- `docs/api.md` - документация API
- Swagger UI доступен по адресу http://localhost:3001/api/docs

### Приложение Г: Результаты EXPLAIN ANALYZE

- Таблицы с результатами до/после индексов
- Планы выполнения запросов

**Источники:**

- `docs/perf.md` - полный анализ производительности

---

## Технические детали LaTeX

### Пакеты для использования

```latex
\usepackage[utf8]{inputenc}
\usepackage[T2A]{fontenc}
\usepackage[russian]{babel}
\usepackage{geometry}
\usepackage{graphicx}
\usepackage{float}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{hyperref}
\usepackage{amsmath}
\usepackage{multirow}
\usepackage{longtable}
```



### Настройки форматирования

```latex
% Поля по ГОСТ
\geometry{
  left=30mm,
  right=15mm,
  top=20mm,
  bottom=20mm
}

% Шрифт Times New Roman, 14pt, межстрочный интервал 1.5
\renewcommand{\rmdefault}{ftm}
\fontsize{14pt}{21pt}\selectfont
\linespread{1.5}

% Абзацный отступ 1.25 см
\setlength{\parindent}{1.25cm}
```



### Оформление кода SQL

```latex
\lstset{
  language=SQL,
  basicstyle=\ttfamily\small,
  keywordstyle=\color{blue},
  commentstyle=\color{gray},
  stringstyle=\color{red},
  numbers=left,
  numberstyle=\tiny,
  frame=single,
  breaklines=true
}
```

---

## Порядок работы

1. **Создание структуры LaTeX проекта**

- Создать директорию `report/`
- Создать файлы для каждого раздела
- Настроить main.tex

2. **Написание титульного листа**

- Использовать информацию из изображения
- Оформить согласно ГОСТ

3. **Написание содержания**

- Составить структуру с номерами страниц (заполнить после написания)

4. **Написание введения**

- Кратко, не более 1 страницы

5. **Написание аналитической части**

- Обзор предметной области
- Постановка задачи

6. **Написание проектной части (основной)**

- Детальное описание всех аспектов
- Включить примеры кода
- Добавить таблицы и рисунки

7. **Написание технологической части**

- Контейнеризация
- Тестирование

8. **Написание заключения**

- Резюме и выводы

9. **Создание приложений**

- ER-диаграмма
- SQL-скрипты
- Скриншоты

10. **Финальная проверка**

    - Проверка соответствия ГОСТ
    - Проверка нумерации страниц
    - Проверка ссылок на рисунки и таблицы
    - Проверка орфографии

---

## Критерии качества отчета

- ✅ Соответствие ГОСТ 7.32-2017
- ✅ Полнота описания всех аспектов проекта