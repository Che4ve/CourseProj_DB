# –û—Ç—á–µ—Ç –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã

## –î–∞—Ç–∞: 11.10.2025

## –¶–µ–ª—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
–£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –ø–æ–ª—É—á–µ–Ω–Ω–æ–π –∫—Ä–∏—Ç–∏–∫–æ–π, —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º —Å race conditions, —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏.

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. **–ó–∞–º–µ–Ω–∞ `toggleCompletion` –Ω–∞ `setCompletion` (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å)**

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–µ–º–∞–Ω—Ç–∏–∫–∞ "toggle" –æ–ø–∞—Å–Ω–∞ –ø—Ä–∏ race conditions. –ë—ã—Å—Ç—Ä—ã–µ –∫–ª–∏–∫–∏ –ø–æ —á–µ–∫–±–æ–∫—Å—É –º–æ–≥—É—Ç –≤—ã–∑–≤–∞—Ç—å –≥–æ–Ω–∫—É –∑–∞–ø—Ä–æ—Å–æ–≤.

**–†–µ—à–µ–Ω–∏–µ:**
- –°–æ–∑–¥–∞–Ω–∞ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `setCompletion(habitId, date, completed: boolean)`
- –Ø–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ –∂–µ–ª–∞–µ–º–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–º–µ—Å—Ç–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `upsert` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–µ–π —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

**–§–∞–π–ª—ã:**
- `app/actions/completionActions.ts` - –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è `setCompletion`
- `components/habits/HabitTracker.tsx` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —á–µ–∫–±–æ–∫—Å–æ–≤

**–ö–æ–¥ –¥–æ:**
```typescript
export async function toggleCompletion(habitId: string, date: string) {
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏
  const { data: existing } = await supabase...
  
  if (existing) {
    // Delete
  } else {
    // Insert
  }
}
```

**–ö–æ–¥ –ø–æ—Å–ª–µ:**
```typescript
export async function setCompletion(habitId: string, date: string, completed: boolean) {
  if (completed) {
    // –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞ —á–µ—Ä–µ–∑ upsert
    await supabase.from('habit_completions')
      .upsert({ habit_id: habitId, completed_at: date },
        { onConflict: 'habit_id,completed_at', ignoreDuplicates: true });
  } else {
    // –ü—Ä—è–º–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
    await supabase.from('habit_completions')
      .delete()
      .eq('habit_id', habitId)
      .eq('completed_at', date);
  }
}
```

---

### 2. **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ª–∏—à–Ω–∏—Ö SQL –∑–∞–ø—Ä–æ—Å–æ–≤**

**–ü—Ä–æ–±–ª–µ–º–∞:** 
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ SELECT –∑–∞–ø—Ä–æ—Å—ã
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ –ø–µ—Ä–µ–¥ –æ–ø–µ—Ä–∞—Ü–∏–µ–π

**–†–µ—à–µ–Ω–∏–µ:**
- –£–±—Ä–∞–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ SELECT –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–ª–∞–¥–µ–Ω–∏—è –ø—Ä–∏–≤—ã—á–∫–æ–π
- –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ RLS –ø–æ–ª–∏—Ç–∏–∫–∞–º Supabase
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `upsert` –≤–º–µ—Å—Ç–æ "–ø—Ä–æ–≤–µ—Ä–∫–∞ ‚Üí –≤—Å—Ç–∞–≤–∫–∞"

**–§–∞–π–ª—ã:**
- `app/actions/completionActions.ts` - —É–¥–∞–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `habit belongs to user`
- `app/actions/habitActions.ts` - —É–±—Ä–∞–Ω –ª–∏—à–Ω–∏–π `.eq('user_id', user.id)` –∏–∑ UPDATE/DELETE

**–≠–∫–æ–Ω–æ–º–∏—è:** –û—Ç 2-3 –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–æ 1 –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—é

---

### 3. **–¢–æ—á–µ—á–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞**

**–ü—Ä–æ–±–ª–µ–º–∞:** `revalidatePath('/')` –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –≤–µ—Å—å –∫–æ—Ä–µ–Ω—å, —á—Ç–æ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `revalidateTag` —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —Ç–µ–≥–∞–º–∏
- –¢–µ–≥–∏: `'habits-list'` –∏ `'habit-{id}'`

**–§–∞–π–ª—ã:**
- `app/actions/habitActions.ts`
- `app/actions/completionActions.ts`

**–ö–æ–¥ –¥–æ:**
```typescript
revalidatePath('/');
```

**–ö–æ–¥ –ø–æ—Å–ª–µ:**
```typescript
revalidateTag('habits-list');
revalidateTag(`habit-${habitId}`);
```

---

### 4. **–£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫**

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–º–µ—à–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π - `throw Error` –∏ `return { error }`.

**–†–µ—à–µ–Ω–∏–µ:**
- –í–µ–∑–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `throw Error`
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö —á–µ—Ä–µ–∑ `try/catch`
- –û—Ç–∫–∞—Ç –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

**–§–∞–π–ª—ã:**
- `app/actions/habitActions.ts`
- `app/actions/completionActions.ts`
- `components/habits/HabitForm.tsx`
- `components/habits/HabitCard.tsx`
- `components/habits/HabitTracker.tsx`

**–ö–æ–¥ –¥–æ:**
```typescript
if (error) {
  return { error: error.message };
}
return { success: true };
```

**–ö–æ–¥ –ø–æ—Å–ª–µ:**
```typescript
if (error) {
  throw new Error(error.message);
}
// Void - —É—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
```

---

### 5. **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞—Ç—ã**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ timestamp –∏ date.

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞—Ç—ã (YYYY-MM-DD)
- –ë–∞–∑–∞ —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–∏–ø `date`, —á—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å

**–§–∞–π–ª—ã:**
- `app/actions/completionActions.ts`

**–ö–æ–¥:**
```typescript
// –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞—Ç—ã (YYYY-MM-DD)
if (!/^\d{4}-\d{2}-\d{2}$/.test(date)) {
  throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã');
}
```

---

### 6. **–£–ª—É—á—à–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤ –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–º UI.

**–†–µ—à–µ–Ω–∏–µ:**
- –ò–∑–º–µ–Ω–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ `useOptimistic` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —è–≤–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

**–§–∞–π–ª—ã:**
- `components/habits/HabitTracker.tsx`

**–ö–æ–¥ –ø–æ—Å–ª–µ:**
```typescript
const [optimisticCompletions, setOptimisticCompletions] = useOptimistic(
  new Set(completions.map((c) => c.completed_at)),
  (state, action: { date: string; completed: boolean }) => {
    const next = new Set(state);
    if (action.completed) {
      next.add(action.date);
    } else {
      next.delete(action.date);
    }
    return next;
  }
);

// –ü—Ä–∏ –æ—à–∏–±–∫–µ - –æ—Ç–∫–∞—Ç
try {
  await setCompletion(habitId, date, checked);
} catch (err) {
  setError(err.message);
  setOptimisticCompletions({ date, completed: !checked }); // –û—Ç–∫–∞—Ç
}
```

---

### 7. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–Ω—Ç–µ—Ä –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π**

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- Type imports: `import type { ... }` –¥–ª—è —Ç–∏–ø–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `useId()` –≤–º–µ—Å—Ç–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ç—Ä–æ–∫ –¥–ª—è `id` –∞—Ç—Ä–∏–±—É—Ç–æ–≤
- –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∏–º–ø–æ—Ä—Ç–æ–≤

**–§–∞–π–ª—ã:**
- `app/actions/habitActions.ts`
- `components/habits/HabitTracker.tsx`
- `components/habits/HabitForm.tsx`
- `components/habits/HabitCard.tsx`

---

### 8. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤**

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –¢–µ—Å—Ç—ã –¥–ª—è `setCompletion` –≤–º–µ—Å—Ç–æ `toggleCompletion`
- –¢–µ—Å—Ç—ã –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞—Ç—ã
- –û–±–Ω–æ–≤–ª–µ–Ω—ã –º–æ–∫–∏ –¥–ª—è `revalidateTag` –≤–º–µ—Å—Ç–æ `revalidatePath`
- –ò–∑–º–µ–Ω–µ–Ω—ã –æ–∂–∏–¥–∞–Ω–∏—è - —Ñ—É–Ω–∫—Ü–∏–∏ —Ç–µ–ø–µ—Ä—å –±—Ä–æ—Å–∞—é—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è, –∞ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ–±—ä–µ–∫—Ç—ã

**–§–∞–π–ª—ã:**
- `__tests__/actions/completions.test.ts`
- `__tests__/actions/habits.test.ts`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –í—Å–µ 16 —Ç–µ—Å—Ç–æ–≤ –¥–ª—è actions –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚ö° **–ú–µ–Ω—å—à–µ SQL –∑–∞–ø—Ä–æ—Å–æ–≤:** —Å 2-3 –¥–æ 1 –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—é
- ‚ö° **–¢–æ—á–µ—á–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞:** –±—ã—Å—Ç—Ä–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
- ‚ö° **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:** –∑–∞—â–∏—Ç–∞ –æ—Ç race conditions

### –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- üõ°Ô∏è **RLS –ø–æ–ª–∏—Ç–∏–∫–∏:** –∑–∞—â–∏—Ç–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î
- üõ°Ô∏è **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:** –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞—Ç—ã
- üõ°Ô∏è **–û—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö:** –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–º UI

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
- ‚ú® **–ï–¥–∏–Ω—ã–π —Å—Ç–∏–ª—å:** throw –≤–º–µ—Å—Ç–æ return { error }
- ‚ú® **Type safety:** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ type imports
- ‚ú® **0 –ª–∏–Ω—Ç–µ—Ä –æ—à–∏–±–æ–∫:** —á–∏—Å—Ç—ã–π –∫–æ–¥
- ‚ú® **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** JSDoc –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ **16/16 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç**
- ‚úÖ **–ü–æ–∫—Ä—ã—Ç–∏–µ –Ω–æ–≤—ã—Ö —Å–ª—É—á–∞–µ–≤:** –≤–∞–ª–∏–¥–∞—Ü–∏—è, –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
- ‚úÖ **0 ESLint –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π**

---

## üîÑ Breaking Changes

### API –∏–∑–º–µ–Ω–µ–Ω–∏—è:
1. **`toggleCompletion` ‚Üí `setCompletion`**
   - –°—Ç–∞—Ä—ã–π: `toggleCompletion(habitId, date)`
   - –ù–æ–≤—ã–π: `setCompletion(habitId, date, completed: boolean)`

2. **–í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è Server Actions**
   - –°—Ç–∞—Ä—ã–π: `Promise<{ success?: true, error?: string }>`
   - –ù–æ–≤—ã–π: `Promise<void>` (–∫–∏–¥–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ)

### –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤:
```typescript
// –°—Ç–∞—Ä—ã–π –∫–æ–¥
const result = await toggleCompletion(id, date);
if (result?.error) {
  handleError(result.error);
}

// –ù–æ–≤—ã–π –∫–æ–¥
try {
  await setCompletion(id, date, isChecked);
} catch (err) {
  handleError(err.message);
}
```

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –±—É–¥—É—â–µ–µ

1. **–ö—ç—à —Ç–µ–≥–∏ –¥–ª—è fetch:**
   ```typescript
   fetch(url, { next: { tags: [`habit-${id}`] } })
   ```

2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ RLS –ø–æ–ª–∏—Ç–∏–∫:**
   - –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —á–µ—Ä–µ–∑ `mcp_supabase_get_advisors`

3. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è:**
   - –î–æ–±–∞–≤–∏—Ç—å Zod –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

4. **–¢–∏–ø–∏–∑–∞—Ü–∏—è –æ—à–∏–±–æ–∫:**
   - –°–æ–∑–¥–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∫–ª–∞—Å—Å—ã –æ—à–∏–±–æ–∫ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- [x] –ó–∞–º–µ–Ω–∏—Ç—å `toggleCompletion` –Ω–∞ `setCompletion` —Å —è–≤–Ω—ã–º boolean
- [x] –£–±—Ä–∞—Ç—å –ª–∏—à–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ habit ownership
- [x] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `upsert` –≤–º–µ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è
- [x] –ó–∞–º–µ–Ω–∏—Ç—å `revalidatePath` –Ω–∞ `revalidateTag`
- [x] –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ (throw everywhere)
- [x] –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `HabitTracker`
- [x] –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã
- [x] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ –ª–∏–Ω—Ç–µ—Ä –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- [x] –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞—Ç—ã
- [x] –£–ª—É—á—à–∏—Ç—å –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ  
**–¢–µ—Å—Ç—ã:** 16/16 ‚úÖ  
**–õ–∏–Ω—Ç–µ—Ä:** 0 –æ—à–∏–±–æ–∫ ‚úÖ  
**–°–±–æ—Ä–∫–∞:** ‚úÖ –£—Å–ø–µ—à–Ω–æ  
**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~30 –º–∏–Ω—É—Ç

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (Update)

### –ü—Ä–æ–±–ª–µ–º–∞ —Å upsert
–ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –æ–±–Ω–∞—Ä—É–∂–∏–ª–∞—Å—å –æ—à–∏–±–∫–∞ "An unexpected response was received from the server" –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —á–µ–∫–±–æ–∫—Å.

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `onConflict` –≤ upsert.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```typescript
// –ë—ã–ª–æ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
.upsert({ ... }, { onConflict: 'habit_id,completed_at', ... })

// –°—Ç–∞–ª–æ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
.upsert({ ... }, { onConflict: 'habit_id, completed_at', ... })
```

**–í–∞–∂–Ω–æ:** –í –ø–∞—Ä–∞–º–µ—Ç—Ä–µ `onConflict` –∫–æ–ª–æ–Ω–∫–∏ —Ä–∞–∑–¥–µ–ª—è—é—Ç—Å—è –∑–∞–ø—è—Ç–æ–π **—Å –ø—Ä–æ–±–µ–ª–æ–º**.

–¢–µ—Å—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∏ –ø—Ä–æ—Ö–æ–¥—è—Ç ‚úÖ

